{"version":3,"file":"centralAudioManager-BrjORTnN.js","sources":["../../src/services/simpleBlobStorage.js","../../src/services/centralAudioManager.js"],"sourcesContent":["/**\n * Simple Blob Storage\n *\n * Einfache und robuste Blob-Speicherung fÃ¼r Audio-Dateien\n */\nimport { audioLogger } from '../utils/audioLogger';\nclass SimpleBlobStorageClass {\n    storage = new Map();\n    STORAGE_KEY = 'aural_simple_blob_storage';\n    constructor() {\n        this.loadFromLocalStorage();\n    }\n    /**\n     * LÃ¤dt gespeicherte Blobs aus LocalStorage\n     */\n    loadFromLocalStorage() {\n        try {\n            const stored = localStorage.getItem(this.STORAGE_KEY);\n            if (stored) {\n                const data = JSON.parse(stored);\n                // Konvertiere Base64 zurÃ¼ck zu Blob\n                Object.entries(data).forEach(([id, blobData]) => {\n                    if (blobData.base64) {\n                        const blob = this.base64ToBlob(blobData.base64, blobData.metadata.type);\n                        if (blob) {\n                            this.storage.set(id, {\n                                id,\n                                blob,\n                                metadata: blobData.metadata\n                            });\n                        }\n                    }\n                });\n                audioLogger.info('manager', 'Loaded blobs from localStorage', { count: this.storage.size });\n            }\n        }\n        catch (error) {\n            audioLogger.error('manager', 'Failed to load blobs from localStorage', { error: error.message });\n        }\n    }\n    /**\n     * Speichert Blobs in LocalStorage\n     */\n    saveToLocalStorage() {\n        try {\n            const data = {};\n            this.storage.forEach((storedBlob, id) => {\n                data[id] = {\n                    base64: this.blobToBase64(storedBlob.blob),\n                    metadata: storedBlob.metadata\n                };\n            });\n            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));\n            audioLogger.info('manager', 'Saved blobs to localStorage', { count: this.storage.size });\n        }\n        catch (error) {\n            audioLogger.error('manager', 'Failed to save blobs to localStorage', { error: error.message });\n        }\n    }\n    /**\n     * Speichert einen Blob\n     */\n    async storeBlob(id, blob, metadata = {}) {\n        const storedBlob = {\n            id,\n            blob,\n            metadata: {\n                title: metadata.title || `Blob ${id}`,\n                size: blob.size,\n                type: blob.type,\n                createdAt: Date.now(),\n                ...metadata\n            }\n        };\n        this.storage.set(id, storedBlob);\n        this.saveToLocalStorage();\n        audioLogger.info('manager', 'Blob stored successfully', {\n            id,\n            size: blob.size,\n            type: blob.type\n        }, id);\n    }\n    /**\n     * LÃ¤dt einen Blob\n     */\n    async getBlob(id) {\n        const storedBlob = this.storage.get(id);\n        if (storedBlob) {\n            audioLogger.info('manager', 'Blob retrieved successfully', {\n                id,\n                size: storedBlob.blob.size,\n                age: Date.now() - storedBlob.metadata.createdAt\n            }, id);\n            return storedBlob.blob;\n        }\n        audioLogger.warn('manager', 'Blob not found', { id }, id);\n        return null;\n    }\n    /**\n     * Erstellt eine Blob-URL\n     */\n    async createBlobUrl(id) {\n        const blob = await this.getBlob(id);\n        if (blob) {\n            const url = URL.createObjectURL(blob);\n            audioLogger.info('manager', 'Blob URL created', { id, url });\n            return url;\n        }\n        return null;\n    }\n    /**\n     * LÃ¶scht einen Blob\n     */\n    async deleteBlob(id) {\n        if (this.storage.has(id)) {\n            this.storage.delete(id);\n            this.saveToLocalStorage();\n            audioLogger.info('manager', 'Blob deleted', { id }, id);\n        }\n    }\n    /**\n     * Gibt alle gespeicherten Blob-IDs zurÃ¼ck\n     */\n    getAllBlobIds() {\n        return Array.from(this.storage.keys());\n    }\n    /**\n     * Gibt Statistiken zurÃ¼ck\n     */\n    getStats() {\n        const blobs = Array.from(this.storage.values());\n        const totalSize = blobs.reduce((sum, blob) => sum + blob.metadata.size, 0);\n        const timestamps = blobs.map(blob => blob.metadata.createdAt);\n        return {\n            count: blobs.length,\n            totalSize,\n            oldestBlob: timestamps.length > 0 ? Math.min(...timestamps) : 0,\n            newestBlob: timestamps.length > 0 ? Math.max(...timestamps) : 0\n        };\n    }\n    /**\n     * Bereinigt alte Blobs\n     */\n    cleanup(maxAge = 7 * 24 * 60 * 60 * 1000) {\n        const cutoffTime = Date.now() - maxAge;\n        const toDelete = [];\n        this.storage.forEach((storedBlob, id) => {\n            if (storedBlob.metadata.createdAt < cutoffTime) {\n                toDelete.push(id);\n            }\n        });\n        toDelete.forEach(id => {\n            this.storage.delete(id);\n            audioLogger.info('manager', 'Cleaned up old blob', { id }, id);\n        });\n        if (toDelete.length > 0) {\n            this.saveToLocalStorage();\n            audioLogger.info('manager', 'Cleanup completed', { deletedCount: toDelete.length });\n        }\n    }\n    /**\n     * Konvertiert Blob zu Base64\n     */\n    blobToBase64(blob) {\n        // FÃ¼r kleine Blobs, verwende FileReader\n        if (blob.size < 10 * 1024 * 1024) { // 10MB\n            return 'data:' + blob.type + ';base64,' + btoa(String.fromCharCode(...new Uint8Array(blob)));\n        }\n        // FÃ¼r groÃŸe Blobs, verwende eine andere Strategie\n        return 'large_blob_' + blob.size + '_' + blob.type;\n    }\n    /**\n     * Konvertiert Base64 zu Blob\n     */\n    base64ToBlob(base64, mimeType) {\n        try {\n            if (base64.startsWith('data:')) {\n                const [header, data] = base64.split(',');\n                const byteCharacters = atob(data);\n                const byteNumbers = new Array(byteCharacters.length);\n                for (let i = 0; i < byteCharacters.length; i++) {\n                    byteNumbers[i] = byteCharacters.charCodeAt(i);\n                }\n                const byteArray = new Uint8Array(byteNumbers);\n                return new Blob([byteArray], { type: mimeType });\n            }\n            return null;\n        }\n        catch (error) {\n            audioLogger.error('manager', 'Failed to convert Base64 to Blob', { error: error.message });\n            return null;\n        }\n    }\n}\n// Singleton-Instanz\nexport const simpleBlobStorage = new SimpleBlobStorageClass();\n// Automatische Bereinigung alle 24 Stunden\nsetInterval(() => {\n    simpleBlobStorage.cleanup();\n}, 24 * 60 * 60 * 1000);\n// Globale Debug-Funktionen\nif (typeof window !== 'undefined') {\n    window.simpleBlobStorage = simpleBlobStorage;\n    window.getSimpleBlobStats = () => simpleBlobStorage.getStats();\n    window.getAllSimpleBlobIds = () => simpleBlobStorage.getAllBlobIds();\n    window.cleanupSimpleBlobs = () => simpleBlobStorage.cleanup();\n}\n","/**\n * Central Audio Manager\n * Zentrale Koordination aller Audio-Operationen\n */\nimport { audioPersistenceManager } from './audioPersistenceManager';\nimport { AudioUrlManager } from './audioUrlManager';\nimport { simpleBlobStorage } from './simpleBlobStorage';\n// import { storeBlob, getBlob, createBlobUrl } from '../utils/audioBlobFix';\n// Temporary replacement functions\nconst storeBlob = (id, blob) => {\n    // Simple implementation\n    console.log('storeBlob called', id, blob);\n};\nconst getBlob = (id) => {\n    // Simple implementation\n    console.log('getBlob called', id);\n    return null;\n};\nconst createBlobUrl = (id) => {\n    // Simple implementation\n    console.log('createBlobUrl called', id);\n    return '';\n};\nclass CentralAudioManagerClass {\n    isInitialized = false;\n    /**\n     * Initialisiert den Audio-Manager\n     */\n    async initialize() {\n        if (this.isInitialized) {\n            return;\n        }\n        console.log('ðŸš€ CentralAudioManager: Initializing...');\n        try {\n            // Migriere bestehende Audio-Daten\n            await this.migrateExistingAudioData();\n            this.isInitialized = true;\n            console.log('âœ… CentralAudioManager: Initialized successfully');\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Initialization failed:', error);\n            throw error;\n        }\n    }\n    /**\n     * Migriert bestehende Audio-Daten\n     */\n    async migrateExistingAudioData() {\n        console.log('ðŸ”„ CentralAudioManager: Migrating existing audio data...');\n        try {\n            // @ts-ignore\n            const db = window.database || {};\n            if (db.tracks) {\n                let migratedCount = 0;\n                for (const track of db.tracks) {\n                    if (track.url && track.url.startsWith('blob:')) {\n                        // Versuche den ursprÃ¼nglichen Blob zu finden\n                        const urlInfo = AudioUrlManager.getUrlInfo(track.id);\n                        if (urlInfo && urlInfo.originalBlob) {\n                            // Migriere zu AudioPersistenceManager\n                            await audioPersistenceManager.storeAudio(track.id, urlInfo.originalBlob);\n                            migratedCount++;\n                        }\n                    }\n                }\n                console.log(`âœ… CentralAudioManager: Migrated ${migratedCount} audio files`);\n            }\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Migration failed:', error);\n        }\n    }\n    /**\n     * Speichert ein neues Audio\n     */\n    async storeNewAudio(trackId, blob) {\n        console.log('ðŸŽµ CentralAudioManager: Storing new audio:', trackId);\n        try {\n            // 1. Speichere in der einfachen In-Memory-Speicherung (sofort verfÃ¼gbar)\n            storeBlob(trackId, blob);\n            // 2. Erstelle Blob-URL\n            const blobUrl = createBlobUrl(trackId);\n            if (!blobUrl) {\n                throw new Error('Failed to create blob URL');\n            }\n            // 3. Speichere auch in SimpleBlobStorage (LocalStorage-basiert)\n            await simpleBlobStorage.storeBlob(trackId, blob, {\n                title: `Track ${trackId}`,\n                size: blob.size,\n                type: blob.type\n            });\n            // 4. Speichere auch in AudioUrlManager fÃ¼r KompatibilitÃ¤t\n            await AudioUrlManager.storeAudioUrl(trackId, blob, 'base64');\n            // 5. Speichere auch in AudioPersistenceManager fÃ¼r zusÃ¤tzliche Sicherheit\n            await audioPersistenceManager.storeAudio(trackId, blob);\n            console.log('âœ… CentralAudioManager: New audio stored successfully with multiple fallbacks');\n            console.log('ðŸ“Š Storage details:', {\n                trackId,\n                blobSize: blob.size,\n                urlType: 'blob',\n                storedIn: ['InMemory', 'SimpleBlobStorage', 'AudioUrlManager', 'AudioPersistenceManager']\n            });\n            return blobUrl;\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Error storing new audio:', error);\n            throw error;\n        }\n    }\n    /**\n     * LÃ¤dt ein Audio fÃ¼r die Wiedergabe\n     */\n    async loadAudioForPlayback(track) {\n        console.log('ðŸŽµ CentralAudioManager: Loading audio for playback:', track.id);\n        try {\n            // 1. Versuche aus der einfachen In-Memory-Speicherung zu laden (schnellster Zugriff)\n            let audioUrl = createBlobUrl(track.id);\n            if (audioUrl) {\n                console.log('âœ… CentralAudioManager: Audio loaded from InMemory storage');\n                return audioUrl;\n            }\n            // 2. Fallback: Versuche aus AudioPersistenceManager zu laden\n            audioUrl = audioPersistenceManager.getAudio(track.id);\n            if (audioUrl) {\n                console.log('âœ… CentralAudioManager: Audio loaded from persistence manager');\n                return audioUrl;\n            }\n            // 3. Fallback: Versuche aus AudioUrlManager zu laden\n            audioUrl = AudioUrlManager.getAudioUrl(track.id);\n            if (audioUrl && audioUrl.startsWith('data:audio/')) {\n                console.log('âœ… CentralAudioManager: Audio loaded from URL manager');\n                return audioUrl;\n            }\n            // 4. Letzter Fallback: Versuche eine neue Blob-URL zu erstellen\n            const blobUrl = await audioPersistenceManager.createTemporaryBlobUrl(track.id);\n            if (blobUrl) {\n                console.log('âœ… CentralAudioManager: Temporary blob URL created');\n                return blobUrl;\n            }\n            // 4. Versuche vom Server zu laden\n            audioUrl = await this.loadAudioFromServer(track);\n            if (audioUrl) {\n                console.log('âœ… CentralAudioManager: Audio loaded from server');\n                return audioUrl;\n            }\n            console.log('âŒ CentralAudioManager: No audio source found');\n            return null;\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Error loading audio:', error);\n            return null;\n        }\n    }\n    /**\n     * LÃ¤dt Audio vom Server\n     */\n    async loadAudioFromServer(track) {\n        try {\n            console.log('ðŸŒ CentralAudioManager: Loading audio from server:', track.id);\n            const possiblePaths = this.generateServerPaths(track);\n            for (const path of possiblePaths) {\n                try {\n                    console.log('ðŸ” CentralAudioManager: Trying server path:', path);\n                    const response = await fetch(path);\n                    if (response.ok) {\n                        const blob = await response.blob();\n                        if (blob.type.startsWith('audio/')) {\n                            console.log('âœ… CentralAudioManager: Found audio on server:', path);\n                            // Speichere fÃ¼r zukÃ¼nftige Verwendung\n                            await audioPersistenceManager.storeAudio(track.id, blob);\n                            // Konvertiere zu Base64\n                            const base64Url = await this.blobToBase64(blob);\n                            return base64Url;\n                        }\n                    }\n                }\n                catch (error) {\n                    console.log('âŒ CentralAudioManager: Server path failed:', path, error);\n                }\n            }\n            return null;\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Error loading from server:', error);\n            return null;\n        }\n    }\n    /**\n     * Generiert mÃ¶gliche Server-Pfade\n     */\n    generateServerPaths(track) {\n        const paths = [];\n        // 1. Direkter filename-Pfad\n        if (track.filename) {\n            paths.push(`https://www.goaural.com/uploads/${track.filename}`);\n        }\n        // 2. User-basierter Pfad\n        if (track.user?.username && track.filename) {\n            paths.push(`https://www.goaural.com/uploads/${track.user.username}/${track.filename}`);\n        }\n        // 3. ID-basierte Pfade\n        const extensions = ['wav', 'mp3', 'webm', 'ogg', 'm4a'];\n        for (const ext of extensions) {\n            paths.push(`https://www.goaural.com/uploads/${track.id}.${ext}`);\n            paths.push(`https://www.goaural.com/uploads/audio_${track.id}.${ext}`);\n        }\n        return paths;\n    }\n    /**\n     * Konvertiert Blob zu Base64\n     */\n    async blobToBase64(blob) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => resolve(reader.result);\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n    }\n    /**\n     * Repariert alle Audio-URLs\n     */\n    async repairAllAudioUrls() {\n        console.log('ðŸ”§ CentralAudioManager: Repairing all audio URLs...');\n        try {\n            // @ts-ignore\n            const db = window.database || {};\n            if (!db.tracks) {\n                console.log('âŒ CentralAudioManager: No tracks found in database');\n                return 0;\n            }\n            let repairedCount = 0;\n            for (const track of db.tracks) {\n                if (track.url && track.url.startsWith('blob:')) {\n                    console.log('ðŸ”§ CentralAudioManager: Repairing track:', track.id);\n                    const newUrl = await this.loadAudioForPlayback(track);\n                    if (newUrl) {\n                        track.url = newUrl;\n                        repairedCount++;\n                        console.log('âœ… CentralAudioManager: Track repaired:', track.id);\n                    }\n                    else {\n                        console.log('âŒ CentralAudioManager: Could not repair track:', track.id);\n                    }\n                }\n            }\n            console.log(`âœ… CentralAudioManager: Repaired ${repairedCount} audio URLs`);\n            return repairedCount;\n        }\n        catch (error) {\n            console.error('âŒ CentralAudioManager: Error repairing audio URLs:', error);\n            return 0;\n        }\n    }\n    /**\n     * Debug-Informationen\n     */\n    getDebugInfo() {\n        return {\n            isInitialized: this.isInitialized,\n            persistenceManager: { type: 'audioPersistenceManager' },\n            availableAudioIds: []\n        };\n    }\n}\n// Singleton-Instanz\nexport const centralAudioManager = new CentralAudioManagerClass();\n// Globale Debug-Funktionen\nif (typeof window !== 'undefined') {\n    window.centralAudioManager = centralAudioManager;\n    window.repairAllAudioUrls = () => centralAudioManager.repairAllAudioUrls();\n    window.getCentralAudioDebugInfo = () => centralAudioManager.getDebugInfo();\n}\n"],"names":["SimpleBlobStorageClass","stored","data","id","blobData","blob","audioLogger","error","storedBlob","metadata","url","blobs","totalSize","sum","timestamps","maxAge","cutoffTime","toDelete","base64","mimeType","header","byteCharacters","byteNumbers","i","byteArray","simpleBlobStorage","storeBlob","createBlobUrl","CentralAudioManagerClass","db","migratedCount","track","urlInfo","AudioUrlManager","audioPersistenceManager","trackId","blobUrl","audioUrl","possiblePaths","path","response","paths","extensions","ext","resolve","reject","reader","repairedCount","newUrl","centralAudioManager"],"mappings":"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"}