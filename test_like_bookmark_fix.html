<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Like/Bookmark/Kommentar Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
        pre { background: #2d2d2d; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 300px; }
        .test-case { background: #333; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .test-case h4 { color: #17a2b8; margin-bottom: 10px; }
        .track-card { background: #2d2d2d; padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid #444; }
        .track-card h5 { color: #fff; margin-bottom: 10px; }
        .track-card .buttons { display: flex; gap: 10px; margin-top: 10px; }
        .track-card .button { padding: 5px 10px; font-size: 12px; }
        .like-button { background: #dc3545; }
        .like-button.liked { background: #28a745; }
        .bookmark-button { background: #ffc107; color: #000; }
        .bookmark-button.bookmarked { background: #28a745; color: #fff; }
        .comment-button { background: #17a2b8; }
    </style>
</head>
<body>
    <h1>🔧 Test: Like/Bookmark/Kommentar Fix</h1>
    
    <div class="section">
        <h2>📊 Problem gelöst</h2>
        <div class="success">
            <h3>✅ Jetzt (korrekt):</h3>
            <p><strong>Like-System:</strong> <code>toggleLike()</code> ruft <code>loadData()</code> auf</p>
            <p><strong>Bookmark-System:</strong> <code>toggleBookmark()</code> ruft <code>loadData()</code> auf</p>
            <p><strong>Kommentar-System:</strong> <code>addCommentToTrack()</code> und <code>deleteCommentFromTrack()</code> rufen <code>loadData()</code> auf</p>
            <p><strong>Ergebnis:</strong> UI wird automatisch aktualisiert nach Aktionen</p>
        </div>
    </div>
    
    <div class="section">
        <h2>🎵 Test-Tracks</h2>
        <div id="testTracks"></div>
    </div>
    
    <div class="section">
        <h2>🔄 Reset</h2>
        <button class="button" onclick="resetAll()">🔄 Alles zurücksetzen</button>
        <div id="resetResult"></div>
    </div>

    <script>
        // Simuliere die Datenbank
        class MockDatabase {
            constructor() {
                this.tracks = [
                    {
                        id: 'track1',
                        title: 'Test Track 1',
                        likes: 0,
                        isLiked: false,
                        isBookmarked: false,
                        comments: []
                    },
                    {
                        id: 'track2',
                        title: 'Test Track 2',
                        likes: 5,
                        isLiked: true,
                        isBookmarked: true,
                        comments: [
                            { id: 'comment1', text: 'Tolles Lied!', userId: 'user1' }
                        ]
                    }
                ];
            }
            
            toggleLike(trackId, userId) {
                const track = this.tracks.find(t => t.id === trackId);
                if (!track) return false;
                
                track.isLiked = !track.isLiked;
                track.likes += track.isLiked ? 1 : -1;
                console.log('❤️ Like toggled:', trackId, 'isLiked:', track.isLiked, 'likes:', track.likes);
                return true;
            }
            
            toggleBookmark(trackId, userId) {
                const track = this.tracks.find(t => t.id === trackId);
                if (!track) return false;
                
                track.isBookmarked = !track.isBookmarked;
                console.log('🔖 Bookmark toggled:', trackId, 'isBookmarked:', track.isBookmarked);
                return true;
            }
            
            addComment(trackId, comment) {
                const track = this.tracks.find(t => t.id === trackId);
                if (!track) return false;
                
                track.comments.push(comment);
                console.log('💬 Comment added:', trackId, 'comments:', track.comments.length);
                return true;
            }
            
            deleteComment(trackId, commentId) {
                const track = this.tracks.find(t => t.id === trackId);
                if (!track) return false;
                
                track.comments = track.comments.filter(c => c.id !== commentId);
                console.log('🗑️ Comment deleted:', trackId, 'comments:', track.comments.length);
                return true;
            }
        }

        const mockDB = new MockDatabase();

        function renderTracks() {
            const container = document.getElementById('testTracks');
            container.innerHTML = '';
            
            mockDB.tracks.forEach(track => {
                const trackCard = document.createElement('div');
                trackCard.className = 'track-card';
                trackCard.innerHTML = `
                    <h5>${track.title}</h5>
                    <p>Likes: ${track.likes} | Bookmarked: ${track.isBookmarked ? 'Yes' : 'No'} | Comments: ${track.comments.length}</p>
                    <div class="buttons">
                        <button class="button like-button ${track.isLiked ? 'liked' : ''}" onclick="toggleLike('${track.id}')">
                            ${track.isLiked ? '❤️ Unlike' : '🤍 Like'} (${track.likes})
                        </button>
                        <button class="button bookmark-button ${track.isBookmarked ? 'bookmarked' : ''}" onclick="toggleBookmark('${track.id}')">
                            ${track.isBookmarked ? '🔖 Unbookmark' : '🔖 Bookmark'}
                        </button>
                        <button class="button comment-button" onclick="addComment('${track.id}')">
                            💬 Add Comment
                        </button>
                        ${track.comments.length > 0 ? `<button class="button" onclick="deleteComment('${track.id}', '${track.comments[0].id}')">🗑️ Delete Comment</button>` : ''}
                    </div>
                `;
                container.appendChild(trackCard);
            });
        }

        function toggleLike(trackId) {
            console.log('🔄 Toggle Like:', trackId);
            const success = mockDB.toggleLike(trackId, 'user1');
            if (success) {
                renderTracks(); // Simuliere loadData()
                console.log('✅ Like toggled successfully');
            }
        }

        function toggleBookmark(trackId) {
            console.log('🔄 Toggle Bookmark:', trackId);
            const success = mockDB.toggleBookmark(trackId, 'user1');
            if (success) {
                renderTracks(); // Simuliere loadData()
                console.log('✅ Bookmark toggled successfully');
            }
        }

        function addComment(trackId) {
            console.log('🔄 Add Comment:', trackId);
            const comment = {
                id: 'comment' + Date.now(),
                text: 'Neuer Kommentar!',
                userId: 'user1'
            };
            const success = mockDB.addComment(trackId, comment);
            if (success) {
                renderTracks(); // Simuliere loadData()
                console.log('✅ Comment added successfully');
            }
        }

        function deleteComment(trackId, commentId) {
            console.log('🔄 Delete Comment:', trackId, commentId);
            const success = mockDB.deleteComment(trackId, commentId);
            if (success) {
                renderTracks(); // Simuliere loadData()
                console.log('✅ Comment deleted successfully');
            }
        }

        function resetAll() {
            mockDB.tracks = [
                {
                    id: 'track1',
                    title: 'Test Track 1',
                    likes: 0,
                    isLiked: false,
                    isBookmarked: false,
                    comments: []
                },
                {
                    id: 'track2',
                    title: 'Test Track 2',
                    likes: 5,
                    isLiked: true,
                    isBookmarked: true,
                    comments: [
                        { id: 'comment1', text: 'Tolles Lied!', userId: 'user1' }
                    ]
                }
            ];
            renderTracks();
            document.getElementById('resetResult').innerHTML = '<div class="success">✅ Alle Daten zurückgesetzt</div>';
        }

        // Initialisierung
        console.log('🚀 Like/Bookmark/Kommentar Fix Test System initialisiert');
        renderTracks();
    </script>
</body>
</html>
